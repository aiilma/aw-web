{"ast":null,"code":"import _objectSpread from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _classCallCheck from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"D:\\\\Projects\\\\php\\\\Laravel\\\\aw.client\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React,{Component}from'react';import{withRouter}from\"react-router-dom\";import CompList from\"./CompList\";import{connect}from\"react-redux\";import SecondaryLayout from\"../../layout/SecondaryLayout\";import{fetchList,clearList}from\"../../../store/ducks/comp-list/operations\";import queryString from'query-string';import{ContentWrapper,PageCaption,Pagination,Preloader}from\"../../common/layout\";import{handleHTTPError,resetHTTPError}from\"../../../store/ducks/error/operations\";import Alert from\"@material-ui/lab/Alert\";var CompositionsContainer=/*#__PURE__*/function(_Component){_inherits(CompositionsContainer,_Component);function CompositionsContainer(props){var _this;_classCallCheck(this,CompositionsContainer);_this=_possibleConstructorReturn(this,_getPrototypeOf(CompositionsContainer).call(this,props));_this.state={currentPage:null,total:null,perPage:null,countPages:null};_this.loadCompositions=_this.loadCompositions.bind(_assertThisInitialized(_this));return _this;}_createClass(CompositionsContainer,[{key:\"componentDidMount\",value:function componentDidMount(){var _this$props=this.props,compositions=_this$props.compositions,location=_this$props.location;if(compositions.length===0){var search=queryString.parse(location.search);if(!(+search.page>0))search.page=1;this.loadCompositions(null,search.page);// const uri = queryString.stringifyUrl({url: location.pathname, query: search});\n// console.log(uri)\n}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){if(this.props.compositions.length>0){this.props.clearList();}this.props.resetHTTPError();}},{key:\"loadCompositions\",value:function loadCompositions(e,to){var _this2=this;var _this$props2=this.props,location=_this$props2.location,fetchList=_this$props2.fetchList,handleHTTPError=_this$props2.handleHTTPError;var uri=queryString.stringifyUrl({url:location.pathname,query:{page:to}});return fetchList(uri).then(function(res){var current_page=res.current_page,per_page=res.per_page,total=res.total;_this2.setState(_objectSpread({},_this2.state,{currentPage:current_page,perPage:per_page,total:total,countPages:Math.ceil(total/per_page)}));}).catch(function(err){return handleHTTPError(err);});}},{key:\"render\",value:function render(){var _this$state=this.state,countPages=_this$state.countPages,currentPage=_this$state.currentPage;var pagerNode=React.createElement(Pagination,{countPages:countPages,count:countPages,onChange:this.loadCompositions,page:currentPage});return React.createElement(SecondaryLayout,null,React.createElement(PageCaption,{title:\"Compositions\"}),React.createElement(ContentWrapper,null,pagerNode,this.props.error.isError?React.createElement(Alert,{severity:\"error\"},this.props.error.message):this.props.isFetching?React.createElement(Preloader,null):this.props.compositions.length>0?React.createElement(CompList,{compositions:this.props.compositions}):React.createElement(Alert,{severity:\"info\"},\"List is empty\"),pagerNode));}}]);return CompositionsContainer;}(Component);var mapStateToProps=function mapStateToProps(state){return{compositions:state.compList.compositions,isFetching:state.compList.isFetching,error:state.error};};export default connect(mapStateToProps,{fetchList:fetchList,clearList:clearList,handleHTTPError:handleHTTPError,resetHTTPError:resetHTTPError})(withRouter(CompositionsContainer));","map":{"version":3,"sources":["D:/Projects/php/Laravel/aw.client/src/views/pages/CompList/Container.js"],"names":["React","Component","withRouter","CompList","connect","SecondaryLayout","fetchList","clearList","queryString","ContentWrapper","PageCaption","Pagination","Preloader","handleHTTPError","resetHTTPError","Alert","CompositionsContainer","props","state","currentPage","total","perPage","countPages","loadCompositions","bind","compositions","location","length","search","parse","page","e","to","uri","stringifyUrl","url","pathname","query","then","res","current_page","per_page","setState","Math","ceil","catch","err","pagerNode","error","isError","message","isFetching","mapStateToProps","compList"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\r\nimport {withRouter} from \"react-router-dom\";\r\nimport CompList from \"./CompList\";\r\nimport {connect} from \"react-redux\";\r\nimport SecondaryLayout from \"../../layout/SecondaryLayout\";\r\nimport {fetchList, clearList} from \"../../../store/ducks/comp-list/operations\";\r\nimport queryString from 'query-string'\r\nimport {ContentWrapper, PageCaption, Pagination, Preloader} from \"../../common/layout\";\r\nimport {handleHTTPError, resetHTTPError} from \"../../../store/ducks/error/operations\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\n\r\n\r\nclass CompositionsContainer extends Component {\r\n    constructor(props) {\r\n        super(props)\r\n        this.state = {\r\n            currentPage: null,\r\n            total: null,\r\n            perPage: null,\r\n            countPages: null,\r\n        }\r\n        this.loadCompositions = this.loadCompositions.bind(this)\r\n    }\r\n\r\n    componentDidMount() {\r\n        const {compositions, location} = this.props\r\n\r\n        if (compositions.length === 0) {\r\n            const search = queryString.parse(location.search)\r\n            if (!(+search.page > 0)) search.page = 1\r\n            this.loadCompositions(null, search.page)\r\n\r\n            // const uri = queryString.stringifyUrl({url: location.pathname, query: search});\r\n            // console.log(uri)\r\n        }\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.props.compositions.length > 0) {\r\n            this.props.clearList()\r\n        }\r\n\r\n        this.props.resetHTTPError()\r\n    }\r\n\r\n    loadCompositions(e, to) {\r\n        const {location, fetchList, handleHTTPError} = this.props\r\n\r\n        const uri = queryString.stringifyUrl({\r\n            url: location.pathname, query: {\r\n                page: to,\r\n            }\r\n        });\r\n\r\n        return fetchList(uri).then(res => {\r\n            const {current_page, per_page, total} = res;\r\n\r\n            this.setState({\r\n                ...this.state,\r\n                currentPage: current_page,\r\n                perPage: per_page,\r\n                total: total,\r\n                countPages: Math.ceil(total / per_page)\r\n            })\r\n        }).catch(err => handleHTTPError(err))\r\n    };\r\n\r\n    render() {\r\n        const {countPages, currentPage} = this.state\r\n\r\n        const pagerNode = <Pagination\r\n            countPages={countPages}\r\n            count={countPages}\r\n            onChange={this.loadCompositions}\r\n            page={currentPage}\r\n        />\r\n\r\n        return (\r\n            <SecondaryLayout>\r\n                <PageCaption title=\"Compositions\"/>\r\n\r\n                <ContentWrapper>\r\n                    {pagerNode}\r\n                    {\r\n                        this.props.error.isError ? <Alert severity=\"error\">{this.props.error.message}</Alert> :\r\n                            this.props.isFetching ?\r\n                                <Preloader/> : this.props.compositions.length > 0 ?\r\n                                <CompList compositions={this.props.compositions}/> :\r\n                                <Alert severity=\"info\">List is empty</Alert>\r\n                    }\r\n                    {pagerNode}\r\n                </ContentWrapper>\r\n            </SecondaryLayout>\r\n        )\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => ({\r\n    compositions: state.compList.compositions,\r\n    isFetching: state.compList.isFetching,\r\n    error: state.error,\r\n})\r\n\r\nexport default connect(mapStateToProps, {fetchList, clearList, handleHTTPError, resetHTTPError})(withRouter(CompositionsContainer))"]},"metadata":{},"sourceType":"module"}